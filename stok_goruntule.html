<!DOCTYPE html>
<html lang="tr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Mobil Stok & SipariÅŸ Takip</title>
Â  Â  
Â  Â  <style>
Â  Â  Â  Â  /* --- MOBÄ°L Ä°Ã‡Ä°N DÄ°KEY VE BASÄ°T CSS --- */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  background-color: #f0f2f5;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  Â  Â  margin: auto;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: #007bff;
Â  Â  Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  padding-bottom: 5px;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #007bff;
Â  Â  Â  Â  }
Â  Â  Â  Â  h2 {
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  margin-top: 25px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  padding: 5px 0;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #ddd;
Â  Â  Â  Â  }
Â  Â  Â  Â  table {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  }
Â  Â  Â  Â  th, td {
Â  Â  Â  Â  Â  Â  border: 1px solid #e0e0e0;
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  }
Â  Â  Â  Â  th {
Â  Â  Â  Â  Â  Â  background-color: #007bff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  position: sticky; 
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Durum Renklendirmeleri */
Â  Â  Â  Â  .status-bekliyor {
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  background-color: #dc3545; 
Â  Â  Â  Â  Â  Â  padding: 2px 6px;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  .status-tamamlandi {
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  background-color: #28a745; 
Â  Â  Â  Â  Â  Â  padding: 2px 6px;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Defisit Renklendirmeleri */
Â  Â  Â  Â  .deficit-red {
Â  Â  Â  Â  Â  Â  color: #dc3545;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  .production-blue {
Â  Â  Â  Â  Â  Â  color: #007bff;
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  }
Â  Â  Â  Â  .loading, .error {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .error {
Â  Â  Â  Â  Â  Â  background-color: #f8d7da;
Â  Â  Â  Â  Â  Â  color: #721c24;
Â  Â  Â  Â  }
Â  Â  Â  Â  .count-cell {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* SipariÅŸ Kodu Mobil GÃ¶rÃ¼nÃ¼mde Gizlendi */
Â  Â  Â  Â  .siparis-kodu {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .plan-box { 
Â  Â  Â  Â  Â  Â  background-color: #e9fff5; 
Â  Â  Â  Â  Â  Â  padding: 10px; 
Â  Â  Â  Â  Â  Â  border-radius: 5px; 
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #refreshButton:disabled {
Â  Â  Â  Â  Â  Â  background-color: #ffc107;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <h1>ğŸ“± Mobil Stok & SipariÅŸ Takip</h1>
Â  Â  Â  Â  
Â  Â  Â  Â  <button id="refreshButton" onclick="fetchData()" style="margin-bottom: 15px; background-color:#28a745; color: white; padding: 10px 15px; border: none; border-radius: 5px; width: 100%;">
Â  Â  Â  Â  Â  Â  ğŸ”„ Verileri Yenile
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <div id="plan-ozeti">
Â  Â  Â  Â  Â  Â  <div class="loading" style="background: none;">Planlama verileri Ã§ekiliyor...</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <h2>ğŸ“¦ Stok ve Ãœretim Eksik Analizi (MÂ²)</h2>
Â  Â  Â  Â  <p style="font-size: 0.8em; color: #666;">*SÄ±ralama: Cins/KalÄ±nlÄ±k ve AÅŸama (Ham/SÄ±valÄ±)</p>
Â  Â  Â  Â  <div id="stok-tablosu">
Â  Â  Â  Â  Â  Â  <div class="loading">Veriler Ã§ekiliyor...</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <h2>ğŸ“‹ TÃ¼m SipariÅŸler (Bekleyen & Tamamlanan)</h2>
Â  Â  Â  Â  <div id="siparis-listesi">
Â  Â  Â  Â  </div>

Â  Â  </div>
Â  Â  
Â  Â  <script>
Â  Â  Â  Â  // API'ye eriÅŸim adresi
Â  Â  Â  Â  const API_URL = "https://eps-final-system-v3.onrender.com/api/stok";
Â  Â  Â  Â  const refreshButton = document.getElementById('refreshButton');

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', fetchData);
        
        // YardÄ±mcÄ± Fonksiyon: SayÄ±larÄ± okunaklÄ± hale getirir
        function formatM2(m2) {
            if (m2 === null || m2 === undefined) return '0';
            // SayÄ±yÄ± TÃ¼rkiye formatÄ±nda (binlik ayracÄ± nokta) ve tam sayÄ± olarak dÃ¶ndÃ¼r
            return parseFloat(m2).toLocaleString('tr-TR', { maximumFractionDigits: 0 });
        }


Â  Â  Â  Â  async function fetchData() {
Â  Â  Â  Â  Â  Â  // --- Ä°yileÅŸtirme 1: Butonu Kitleme ve YÃ¼kleme MesajlarÄ± ---
            refreshButton.disabled = true;
            refreshButton.textContent = 'â³ Veriler YÃ¼kleniyor...';

Â  Â  Â  Â  Â  Â  // YÃ¼kleme mesajlarÄ±nÄ± gÃ¶ster
Â  Â  Â  Â  Â  Â  document.getElementById('plan-ozeti').innerHTML = '<div class="loading" style="background: none;">Planlama verileri Ã§ekiliyor...</div>';
Â  Â  Â  Â  Â  Â  document.getElementById('stok-tablosu').innerHTML = '<div class="loading">ğŸ“¦ Stok verileri Ã§ekiliyor...</div>';
Â  Â  Â  Â  Â  Â  document.getElementById('siparis-listesi').innerHTML = '<div class="loading">ğŸ“‹ SipariÅŸ verileri Ã§ekiliyor...</div>';
Â  Â  Â  Â  Â  Â  
            let success = false;
            
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(API_URL);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`API eriÅŸim hatasÄ±: HTTP ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  renderPlanlama(data.toplam_gerekli_siva, data.gunluk_siva_m2, data.siva_plan_detay, data.sevkiyat_plan_detay);
Â  Â  Â  Â  Â  Â  Â  Â  renderStok(data.stok, data.deficit_analysis); 
Â  Â  Â  Â  Â  Â  Â  Â  renderSiparisler(data.siparisler); 
                success = true;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Fetch Error:", error); 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('stok-tablosu').innerHTML = `<div class="error">BaÄŸlantÄ± HatasÄ±: API'ye ulaÅŸÄ±lamÄ±yor veya veri formatÄ± hatalÄ±. (${error.message})</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('siparis-listesi').innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('plan-ozeti').innerHTML = '';
Â  Â  Â  Â  Â  Â  } finally {
                // --- Ä°yileÅŸtirme 1: Butonu Serbest BÄ±rakma ---
                refreshButton.disabled = false;
                refreshButton.textContent = success ? 'âœ… Veriler GÃ¼ncellendi' : 'ğŸ”„ Verileri Yenile (Hata)';
                setTimeout(() => { 
                    if (refreshButton.textContent.includes('GÃ¼ncellendi')) {
                        refreshButton.textContent = 'ğŸ”„ Verileri Yenile';
                    }
                }, 3000); // BaÅŸarÄ±lÄ± mesajÄ±nÄ± 3 saniye sonra kaldÄ±r.
            }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Yeni Planlama Render Fonksiyonu
Â  Â  Â  Â  function renderPlanlama(toplam_eksi_m2, kapasite, sivaPlan, sevkiyatPlan) {
Â  Â  Â  Â  Â  Â  let html = `<h2 style="color: #00a359;">ğŸš€ Ãœretim Planlama (Kapasite: ${formatM2(kapasite)} mÂ²/gÃ¼n)</h2>`;

Â  Â  Â  Â  Â  Â  if (toplam_eksi_m2 > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  html += `<p style="font-weight: bold; color: darkred; font-size: 0.9em;">Toplam SÄ±va MÂ² EksiÄŸi: ${formatM2(toplam_eksi_m2)} mÂ²</p>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â html += `<p style="font-weight: bold; color: green; font-size: 0.9em;">SÄ±valÄ± malzeme ihtiyacÄ± stoktan karÅŸÄ±lanabiliyor.</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  <div style="display: flex; gap: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="plan-box" style="flex: 1; background-color: #d8f5ff; border: 1px solid #17a2b8;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>SÄ±va Ãœretim PlanÄ± (5 GÃ¼n)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sivaKeys = Object.keys(sivaPlan);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (sivaKeys.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sivaKeys.forEach(gun => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<tr><td>GÃ¼n ${gun}</td><td>${formatM2(sivaPlan[gun])} mÂ²</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<tr><td colspan="2">Ä°htiyaÃ§ yok.</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `</table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="plan-box" style="flex: 1; background-color: #fff0d8; border: 1px solid #cc8400;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Sevkiyat PlanÄ± (5 GÃ¼n)</h3>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sevkiyatKeys = Object.keys(sevkiyatPlan);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (sevkiyatKeys.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sevkiyatKeys.forEach(tarih => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sevkiyatlar = sevkiyatPlan[tarih];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toplamM2 = sevkiyatlar.reduce((sum, s) => sum + s.bekleyen_m2, 0);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin: 5px 0 2px 0; color: #0056b3; font-size: 0.9em;">${tarih} (${formatM2(toplamM2)} mÂ²)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul style="list-style: none; padding: 0; margin-left: 5px; font-size: 0.8em;">`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sevkiyatlar.forEach(s => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<li>- ${s.urun_kodu}: ${formatM2(s.bekleyen_m2)} mÂ² (${s.musteri})</li>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `</ul>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<p style="font-size: 0.9em;">Ã–nÃ¼mÃ¼zdeki 5 gÃ¼n terminli sevkiyat yok.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  Â  Â  document.getElementById('plan-ozeti').innerHTML = html;
Â  Â  Â  Â  }


Â  Â  Â  Â  function renderStok(stokData, deficitAnalysis) {
Â  Â  Â  Â  Â  Â  // BaÅŸlÄ±klar: AÅŸama/Cins | MÂ² | Eksik SÄ±valÄ± MÂ² | Eksik Ham MÂ²
Â  Â  Â  Â  Â  Â  let html = '<table><tr><th>AÅŸama/Cins</th><th>MÂ²</th><th>Eksik SÄ±valÄ± MÂ²</th><th>Eksik Ham MÂ²</th></tr>';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // SÄ±ralanmÄ±ÅŸ anahtarlar
Â  Â  Â  Â  Â  Â  const sortedKeys = Object.keys(stokData).sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  const [cinsiA, kalinlikA, asamaA] = a.split(/ \((.*)\)/);
Â  Â  Â  Â  Â  Â  Â  Â  const [cinsiB, kalinlikB, asamaB] = b.split(/ \((.*)\)/);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (cinsiA !== cinsiB) return cinsiA.localeCompare(cinsiB);
Â  Â  Â  Â  Â  Â  Â  Â  if (kalinlikA !== kalinlikB) return kalinlikA.localeCompare(kalinlikB);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const orderMap = {'Ham': 0, 'Sivali': 1};
Â  Â  Â  Â  Â  Â  Â  Â  return orderMap[asamaA.trim()] - orderMap[asamaB.trim()];
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  sortedKeys.forEach(key => {
Â  Â  Â  Â  Â  Â  Â  Â  const value = stokData[key];
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const itemKey = key.substring(0, key.lastIndexOf(' (')); 
Â  Â  Â  Â  Â  Â  Â  Â  const asama = key.substring(key.lastIndexOf('(') + 1, key.lastIndexOf(')'));
Â  Â  Â  Â  Â  Â  Â  Â  const deficitInfo = deficitAnalysis[itemKey]; 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  let sivaliDeficitText = '-';
Â  Â  Â  Â  Â  Â  Â  Â  let hamDeficitText = '-';
Â  Â  Â  Â  Â  Â  Â  Â  let sivaliDeficit = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let hamDeficit = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let hamCoverage = 0;

Â  Â  Â  Â  Â  Â  Â  Â  // Defisit DeÄŸerlerini Hesapla/Al
Â  Â  Â  Â  Â  Â  Â  Â  if (deficitInfo) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sivaliDeficit = deficitInfo.sivali_deficit || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hamDeficit = deficitInfo.ham_deficit || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hamCoverage = deficitInfo.ham_coverage || 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // SIVALI SatÄ±rÄ±
Â  Â  Â  Â  Â  Â  Â  Â  if (asama === 'Sivali') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (sivaliDeficit > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sivaliDeficitText = `<span class="deficit-red">${formatM2(sivaliDeficit)} mÂ² EKSÄ°K</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // HAM SatÄ±rÄ±
Â  Â  Â  Â  Â  Â  Â  Â  if (asama === 'Ham') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (hamDeficit > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hamDeficitText = `<span class="deficit-red">${formatM2(hamDeficit)} mÂ² EKSÄ°K</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (hamCoverage > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â sivaliDeficitText = `<span class="production-blue">(Ãœretim PlanÄ±: ${formatM2(hamCoverage)} mÂ²)</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // SÄ±fÄ±r StoklarÄ± Gizleme MantÄ±ÄŸÄ± (Sadece Pozitif/Negatif stok veya eksik sipariÅŸ varsa gÃ¶ster)
Â  Â  Â  Â  Â  Â  Â  Â  if (value !== 0 || sivaliDeficit > 0 || hamDeficit > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${key}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="count-cell">${formatM2(value)} mÂ²</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${sivaliDeficitText}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${hamDeficitText}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  html += '</table>';
Â  Â  Â  Â  Â  Â  document.getElementById('stok-tablosu').innerHTML = html;
Â  Â  Â  Â  }

Â  Â  Â  Â  // planlanan_is_gunu API'den siparisler objesi iÃ§inde geliyor.
Â  Â  Â  Â  function renderSiparisler(siparisler) {
Â  Â  Â  Â  Â  Â  const tumSiparisler = siparisler; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // YENÄ° BAÅLIKLAR: Sip. Tarihi, MÃ¼ÅŸteri, ÃœrÃ¼n, MÂ², Durum, Termin, SÄ±valÄ± Zemin (GÃ¼n)
Â  Â  Â  Â  Â  Â  let html = '<table><tr><th>Sip. Tarihi</th><th>MÃ¼ÅŸteri</th><th>ÃœrÃ¼n</th><th>MÂ²</th><th>Durum</th><th>Termin</th><th>SÄ±valÄ± Zemin (GÃ¼n)</th></tr>';

Â  Â  Â  Â  Â  Â  if (tumSiparisler.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  html += '<tr><td colspan="7" style="text-align:center; color:#666; font-weight:bold;">Aktif veya tamamlanmÄ±ÅŸ sipariÅŸ bulunmamaktadÄ±r.</td></tr>';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  tumSiparisler.forEach(s => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let statusClass = s.durum === 'Bekliyor' ? 'status-bekliyor' : 'status-tamamlandi';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Bekleyen M2: TamamlandÄ±ysa 0 gÃ¶sterilir, formatlanÄ±r.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let bekleyenM2 = s.durum === 'Bekliyor' ? `${formatM2(s.bekleyen_m2)} mÂ²` : '0 mÂ²';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let planlananGunText = '-';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (s.durum === 'Bekliyor') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (s.planlanan_is_gunu === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  planlananGunText = `<span style="color: green;">Stoktan</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (s.planlanan_is_gunu > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  planlananGunText = `<b>${s.planlanan_is_gunu} GÃ¼n</b>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  planlananGunText = `Kapasite Yok`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${s.siparis_tarihi}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${s.musteri}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${s.urun_kodu}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="count-cell">${bekleyenM2}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="${statusClass}">${s.durum.toUpperCase()}</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${s.termin_tarihi}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${planlananGunText}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  html += '</table>';
Â  Â  Â  Â  Â  Â  document.getElementById('siparis-listesi').innerHTML = html;
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>